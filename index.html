---
---
{% comment %}
Empty frontmatter so that jekyll knows that this HTML file needs processing.
See: https://jekyllrb.com/docs/front-matter/
{% endcomment %}

<!DOCTYPE html>
<html lang="de">
  <head>
    <title>War-o-Mat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="assets/css/fonts/fontawsome/css/all.min.css" rel="stylesheet" />

    <style>
      @import url('assets/css/reset.css') layer(reset);
      @import url('assets/css/layout.css') layer(layout);

      @import url('assets/css/tokens/motion.css') layer(tokens);
      @import url('assets/css/tokens/colors.css') layer(tokens);
      @import url('assets/css/tokens/typography.css') layer(tokens);

      @import url('assets/css/components/stacked-list.css') layer(components);
      @import url('assets/css/components/jumpnav.css') layer(components);
      @import url('assets/css/components/question.css') layer(components);
      @import url('assets/css/components/button.css') layer(components);

      :root {
        --primary-hue: 90deg;
        /* Gold */
        /* 123deg ~ TableTopTroll grün */

        accent-color: var(--color-primary);
        scrollbar-color: var(--color-primary) transparent;
      }

      main {
        display: grid;
        grid-template-columns: subgrid;
        gap: inherit;
        justify-items: center;
      }

      #war-o-mat {
        display: grid;
        gap: inherit;
      }


      #result {
        margin-block-start: 1.5em;
      }

      #result h2 {
        margin-block-end: 1em;
      }

      #result ol {
        display: grid;
        gap: 2em;

        & > * {
          width: min(55ch, 100%);
        }

         & > :nth-child(1) {
          justify-self: center;
        }

         & > :nth-child(2) {
          justify-self: start;
        }

         & > :nth-child(3) {
          justify-self: end;
        }
      }

      .hidden {
        display: none;
      }

      footer {
        height: auto;
        align-self: flex-end;
        margin-top: 2rem;

        display: flex;
        flex-flow: row wrap;
        justify-content: center;
      }
    </style>
    <script>
            const ATTRIBUTE_FACTION_VALUE = {
                "casting": {
                    "__1": "Zauber wirken",
                    "__2": "Götter anrufen",
                    "Nighthaunt": -1,
                    "Ossiarch": -1,
                    "FEC": -1,
                    "SBTG": -1,
                    "Ogor": -1,
                    "SoB": 0,
                    "Orruks": -1,
                    "Gitz": -2,
                    "Khorne": 2,
                    "Nurgle": -1,
                    "Slanesh": 0,
                    "Tzeentch": -2,
                    "Skaven": -1,
                    "STD": -1,
                    "CoS": 0,
                    "Sylvaneth": -2,
                    "Fyreslayers": 2,
                    "Idoneth": -1,
                    "DoK": -2,
                    "Lumineth": -2,
                    "Seraphon": -2,
                    "Stormcast": -2,
                    "Kharadron": 0
                },
                "kampfstil": {
                    "__1": "Nahkampflastig",
                    "__2": "Fernkampflastig",
                    "Nighthaunt": -1,
                    "Ossiarch": -1,
                    "FEC": -2,
                    "SBTG": -1,
                    "Ogor": -1,
                    "SoB": -2,
                    "Orruks": -2,
                    "Gitz": 0,
                    "Khorne": -2,
                    "Nurgle": -1,
                    "Slanesh": 1,
                    "Tzeentch": 1,
                    "Skaven": 0,
                    "STD": 0,
                    "CoS": 1,
                    "Sylvaneth": -1,
                    "Fyreslayers": -2,
                    "Idoneth": 1,
                    "DoK": -2,
                    "Lumineth": 0,
                    "Seraphon": -2,
                    "Stormcast": -2,
                    "Kharadron": 2
                },
                "temperament": {
                    "__1": "Kalt / Berechnend",
                    "__2": "Heißblütig / Wild",
                    "Nighthaunt": 0,
                    "Ossiarch": -1,
                    "FEC": 2,
                    "SBTG": -1,
                    "Ogor": 2,
                    "SoB": 2,
                    "Orruks": 2,
                    "Gitz": 0,
                    "Khorne": 2,
                    "Nurgle": 0,
                    "Slanesh": -1,
                    "Tzeentch": -1,
                    "Skaven": 0,
                    "STD": 0,
                    "CoS": -1,
                    "Sylvaneth": -1,
                    "Fyreslayers": 2,
                    "Idoneth": -1,
                    "DoK": 2,
                    "Lumineth": -1,
                    "Seraphon": -2,
                    "Stormcast": -2,
                    "Kharadron": -1
                },
                "aufstellung": {
                    "__1": "Viele Spezialisten",
                    "__2": "Viele Generalisten",
                    "Nighthaunt": 0,
                    "Ossiarch": -1,
                    "FEC": 0,
                    "SBTG": -1,
                    "Ogor": 0,
                    "SoB": 2,
                    "Orruks": 1,
                    "Gitz": -1,
                    "Khorne": 1,
                    "Nurgle": 0,
                    "Slanesh": -1,
                    "Tzeentch": -1,
                    "Skaven": -2,
                    "STD": -1,
                    "CoS": 0,
                    "Sylvaneth": 0,
                    "Fyreslayers": 1,
                    "Idoneth": 1,
                    "DoK": 1,
                    "Lumineth": -1,
                    "Seraphon": -1,
                    "Stormcast": -2,
                    "Kharadron": 1
                },
                "spielmotivation": {
                    "__1": "Gewinnorientiert",
                    "__2": "Spaßorientiert",
                    "Nighthaunt": 0,
                    "Ossiarch": -1,
                    "FEC": 0,
                    "SBTG": 0,
                    "Ogor": 1,
                    "SoB": 2,
                    "Orruks": 2,
                    "Gitz": 2,
                    "Khorne": 2,
                    "Nurgle": -1,
                    "Slanesh": -1,
                    "Tzeentch": -1,
                    "Skaven": 2,
                    "STD": -1,
                    "CoS": 0,
                    "Sylvaneth": -1,
                    "Fyreslayers": 1,
                    "Idoneth": -1,
                    "DoK": 1,
                    "Lumineth": -1,
                    "Seraphon": -1,
                    "Stormcast": -2,
                    "Kharadron": 0
                },
                "truppengroesse": {
                    "__1": "Horde / viele Modelle",
                    "__2": "Elite / wenig Modelle",
                    "Nighthaunt": -1,
                    "Ossiarch": -1,
                    "FEC": 1,
                    "SBTG": -1,
                    "Ogor": 1,
                    "SoB": 2,
                    "Orruks": -2,
                    "Gitz": -1,
                    "Khorne": 1,
                    "Nurgle": 1,
                    "Slanesh": -1,
                    "Tzeentch": 0,
                    "Skaven": -2,
                    "STD": 1,
                    "CoS": 0,
                    "Sylvaneth": -1,
                    "Fyreslayers": -1,
                    "Idoneth": 0,
                    "DoK": 0,
                    "Lumineth": -1,
                    "Seraphon": -1,
                    "Stormcast": -2,
                    "Kharadron": 1
                },
                "beweglichkeit": {
                    "__1": "Schwerfällig & Zäh",
                    "__2": "Flink & Schwach",
                    "Nighthaunt": 1,
                    "Ossiarch": -1,
                    "FEC": 1,
                    "SBTG": 1,
                    "Ogor": -2,
                    "SoB": -2,
                    "Orruks": -1,
                    "Gitz": 2,
                    "Khorne": -1,
                    "Nurgle": -1,
                    "Slanesh": 2,
                    "Tzeentch": 1,
                    "Skaven": 2,
                    "STD": -1,
                    "CoS": 1,
                    "Sylvaneth": 0,
                    "Fyreslayers": -1,
                    "Idoneth": 2,
                    "DoK": 2,
                    "Lumineth": 2,
                    "Seraphon": -1,
                    "Stormcast": -2,
                    "Kharadron": 1
                },
                "strategie": {
                    "__1": "Heimlich / Hinterrücks",
                    "__2": "Direkt / Konfrontativ",
                    "Nighthaunt": -1,
                    "Ossiarch": 1,
                    "FEC": 1,
                    "SBTG": -1,
                    "Ogor": 2,
                    "SoB": 2,
                    "Orruks": 2,
                    "Gitz": -2,
                    "Khorne": 2,
                    "Nurgle": 1,
                    "Slanesh": -2,
                    "Tzeentch": -1,
                    "Skaven": -2,
                    "STD": 1,
                    "CoS": 1,
                    "Sylvaneth": -1,
                    "Fyreslayers": 2,
                    "Idoneth": -1,
                    "DoK": 2,
                    "Lumineth": -2,
                    "Seraphon": 1,
                    "Stormcast": 2,
                    "Kharadron": -1
                },
                "technologie": {
                    "__1": "Technologisch fortschrittlich",
                    "__2": "Klassische Kriegsführung",
                    "Nighthaunt": 2,
                    "Ossiarch": 1,
                    "FEC": 1,
                    "SBTG": 0,
                    "Ogor": 2,
                    "SoB": 2,
                    "Orruks": 2,
                    "Gitz": 0,
                    "Khorne": 1,
                    "Nurgle": 1,
                    "Slanesh": 1,
                    "Tzeentch": 1,
                    "Skaven": -2,
                    "STD": 1,
                    "CoS": -1,
                    "Sylvaneth": 2,
                    "Fyreslayers": 2,
                    "Idoneth": 1,
                    "DoK": 2,
                    "Lumineth": -1,
                    "Seraphon": 1,
                    "Stormcast": 2,
                    "Kharadron": -2
                },
                "modelle": {
                    "__1": "Große Auswahl an Modellen",
                    "__2": "Geringe Auswahl an Modellen",
                    "Nighthaunt": -1,
                    "Ossiarch": 0,
                    "FEC": 0,
                    "SBTG": -1,
                    "Ogor": 1,
                    "SoB": 2,
                    "Orruks": -1,
                    "Gitz": -1,
                    "Khorne": 0,
                    "Nurgle": 1,
                    "Slanesh": -2,
                    "Tzeentch": 0,
                    "Skaven": -2,
                    "STD": -1,
                    "CoS": -1,
                    "Sylvaneth": 0,
                    "Fyreslayers": 2,
                    "Idoneth": 0,
                    "DoK": 1,
                    "Lumineth": -1,
                    "Seraphon": 0,
                    "Stormcast": -2,
                    "Kharadron": 1
                },
                "helden": {
                    "__1": "Viele (namenhafte) Helden",
                    "__2": "Wenig (namenhafte) Helden",
                    "Nighthaunt": -1,
                    "Ossiarch": 0,
                    "FEC": -1,
                    "SBTG": -2,
                    "Ogor": 1,
                    "SoB": 2,
                    "Orruks": 0,
                    "Gitz": 0,
                    "Khorne": 1,
                    "Nurgle": 0,
                    "Slanesh": -2,
                    "Tzeentch": 0,
                    "Skaven": -2,
                    "STD": -1,
                    "CoS": -1,
                    "Sylvaneth": 0,
                    "Fyreslayers": 2,
                    "Idoneth": 1,
                    "DoK": 1,
                    "Lumineth": -1,
                    "Seraphon": 0,
                    "Stormcast": -2,
                    "Kharadron": 1
                }
            }
    </script>
    <script>
            function revealResult() {
                document.getElementById('show-results-button').remove();
                document.getElementById('result').classList.remove('hidden');
            }

            function getActiveQuestionNo() {
                const active_question = document.querySelector('#question-list > .active');
                return !active_question ? 0 : [...active_question.parentNode.children].indexOf(active_question);
            }

            function syncJumpNav(){
                const questionList = document.getElementById('question-list');
                const jumpNav = document.getElementById('jumpnav');

                // Set jumpNav item to .done if question input is :checked
                questionList.querySelectorAll('li').forEach((listItem, i) => {
                    const checked = listItem.querySelector('input:checked');
                    const active = listItem.classList.contains('active');
                    const jumpNavItem = jumpNav.children[i];
                    if (checked) {
                        jumpNavItem.classList.add('done');
                    } else {
                        jumpNavItem.classList.remove('done');
                    }
                    if (active) {
                        jumpNavItem.classList.add('active');
                    } else {
                        jumpNavItem.classList.remove('active');
                    }
                });
            }

            function gotoQuestionNo(questionNo) {
                const question_list = document.getElementById('question-list');
                const active_questions = question_list.querySelectorAll('.active');
                active_questions.forEach((question) => question.classList.remove('active'));
                active_question = question_list.children[questionNo]
                active_question.classList.add('active');

                syncJumpNav();
            }

            function gotoNext() {
                const current = getActiveQuestionNo();
                if (current === undefined) gotoQuestionNo(0);

                const questions = document.getElementById('question-list').children;
                if (current < questions.length - 1) {
                    gotoQuestionNo(current + 1);
                } else {
                    revealResult();
                }
            }

            function unlockSkipButton() {
                document.getElementById('show-results-button').classList.remove('hidden');
            }

            function complete(question) {
                gotoNext();
                unlockSkipButton();
                syncJumpNav();
            }


            const euclideanDistance = (a, b) => Math.hypot(...Object.keys(a).map(k => b[k] - a[k]));
            const euclideanQuadraticDistance = (a, b) => Object.keys(a).reduce((acc, k) => acc + (b[k] - a[k]) ** 2, 0);

            document.addEventListener('DOMContentLoaded', () => {
                const form = document.getElementById('war-o-mat');
                const questionList = document.getElementById('question-list');
                const jumpNav = document.getElementById('jumpnav');

                questionList.querySelectorAll('input[type="radio"]').forEach((radio) => {
                    radio.addEventListener('change', (event) => {
                        complete(event.target.closest('.question'));
                    });
                });
      

                form.addEventListener('reset', (event) => {
                    setTimeout(function() {
                        gotoQuestionNo(0);
                        document.getElementById('show-results-button').classList.add('hidden');
                        syncJumpNav();
                     }, 10);
                });

                form.addEventListener('input', (event) => {
                    const formData = Object.fromEntries(new FormData(form).entries());
                    console.log(formData);

                    let vector = [];
                    let faction_vectors = {};

                    for (let [id, value] of Object.entries(formData)) {
                        if (id.startsWith('double-')) {
                            id = id.replace('double-', '');
                            value = formData[id];
                        }

                        const numValue = parseInt(value);
                        if (isNaN(numValue)) continue;

                        vector.push(numValue);
                        vector_for_faction = {};

                        for (const [faction, faction_value] of Object.entries(ATTRIBUTE_FACTION_VALUE[id])) {
                            if (faction.startsWith('__')) continue;
                            if (!faction_vectors[faction]) {
                                faction_vectors[faction] = [];
                            }
                            faction_vectors[faction].push(faction_value);
                        }
                    }

                    // map over values from faction_vectors and calculate the distance to the vector
                    const distances = Object.entries(faction_vectors).map(([faction, faction_vector]) => {
                        return {
                            faction,
                            euclidean: euclideanQuadraticDistance(vector, faction_vector)
                        }
                    }).sort((a, b) => a.euclidean - b.euclidean);

                    console.log("Vector: ", vector);

                    const resultList = document.getElementById("result-list");
                    resultList.replaceChildren(
                        ...distances.slice(0, 3).map(({faction, euclidean}) => {
                            const template = document.getElementById(faction);
                            return template.content.cloneNode(true);
                        })
                    );
                });
            });
    </script>
  </head>

  <body>
    <div id="header">
      <div class="wrap">
        <img src="assets/images/logo.png" alt="Tabletoptroll Logo">
        <div class="header-nav">
          <a href="https://www.instagram.com/tabletoptroll/" target="_blank" class="social">
            <i class="fa-brands fa-instagram"></i>
          </a>
          <a href="https://www.youtube.com/@tabletoptroll" target="_blank" class="social">
            <i class="fa-brands fa-youtube"></i>
          </a>
        </div>
      </div>
    </div>

    <div id="content">
      <div id="left">
        <div class="intro">
          <h1>War-o-Mat</h1>
          <p>
            Der Tabletoptroll präsentiert: Den War-o-Mat! 
            Beantworte die Fragen und finde heraus, welche Warhammer Age of Sigmar Fraktion am besten zu deiner Spielweise passt. 
          </p>
        </div>
        <form id="war-o-mat">
          <div class="wrap">
            <ol id="question-list" class="stacked-list">
              {% for attribute in site.data.csv.attributes %}
                <li
                  id="question-{{ forloop.index }}"
                  {% if forloop.first %}
                  class="active"
                  {% endif %}>
                  {% include question.html question=attribute %}
                </li>
              {% endfor %}
            </ol>
            <nav style="display: flex; justify-content: space-between">
              <ol id="jumpnav">
                {% for attribute in site.data.csv.attributes %}
                  <li
                    {% if forloop.first %}
                    class="active"
                    {% endif %}>
                    <a aria-label="Frage {{ forloop.index }}" onclick="gotoQuestionNo({{ forloop.index0 }})">
                      <i class="fa-solid fa-check"></i>
                    </a>
                  </li>
                {% endfor %}
              </ol>
            </nav>
          </div>
          <div class="formbtn">
            <button
            id="show-results-button"
            class="button text hidden"
            onclick="event.preventDefault(); revealResult();"
            style="justify-self: center;">
            Zeig mir meine Fraktion jetzt!
            <i class="fa-solid fa-circle-arrow-right"></i>
          </button>
            <button
            class="icon-button"
            type="reset"
            aria-label="Zurücksetzen">
            ↺
          </button>
          </div>
        </form>
      </div>
      
      <div id="right">
        <div class="hidden" id="result">
          <h2>Für dich empfohlen</h2>
          <ol id="result-list"></ol>
        </div>
      </div>

    </div>

    
  {% comment %}
  Hier werden die Templates für die Fraktionen generiert.
{% endcomment %}
{% for faction in site.data.csv.factions %}
  <template id="{{faction.id}}">
    <article>
      <h3>{{ faction.full_name }}</h3>
      <p style="margin-block-end: 1em;">{{ faction.description }}</p>
      <a class="button filled" href="{{faction.affiliate_link}}">Hier geht's zum Set!</a>
    </article>
  </template>
{% endfor %}
    <footer>
      <div class="wrap">
        <div class="footer-nav">
          <a class="link" href="https://www.instagram.com/tabletoptroll/">
            <img src="assets/images/logo-white.png" alt="Winterrabe Logo">
          </a>
          <a class="link" href="https://taschengelddieb.de/?affiliate=ttt">
            <img src="assets/images/shoplogo.png" alt="Taschengelddieb Logo">
          </a>

          <a class="button text link" href="impressum.html">Impressum</a>
        </div>
        <input
          style="display: none; width: 100%"
          type="range"
          value="46"
          min="0"
          max="360"
          oninput="document.querySelector(':root').style.setProperty('--primary-hue', event.target.value)" />
      </div>
    </footer>
  </body>
</html>